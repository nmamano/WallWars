(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{100:function(e,t){},151:function(e,t,n){"use strict";n.r(t);var a=n(0),l=n.n(a),r=n(34),o=n.n(r),c=(n(70),n(4)),i=n(62),s=n(5),m=n(61),u=n.n(m),f=n(38),g=n(35),d=n.n(g),p=n(64);function h(e){return e.r%2===0&&e.c%2===0?"Ground":e.r%2===0&&e.c%2===1||e.r%2===1&&e.c%2===0?"Wall":"Pillar"}function v(e,t){return e.r===t.r&&e.c===t.c}function y(e,t){return e.r>=0&&e.r<t.h&&e.c>=0&&e.c<t.w}function C(e,t){return"Wall"===h(t)&&0!==e[t.r][t.c]}function E(e,t){var n=function(e){return{h:e.length,w:e[0].length}}(e);if("Ground"!==h(t))return[];for(var a=[{r:0,c:1},{r:0,c:-1},{r:1,c:0},{r:-1,c:0}],l=[],r=[t.r,t.c],o=r[0],c=r[1],i=0;i<a.length;i++){var s=[a[i].r,a[i].c],m=s[0],u=s[1],f={r:o+m,c:c+u},g={r:o+2*m,c:c+2*u};y(g,n)&&!C(e,f)&&l.push(g)}return l}function b(e,t,n){if(v(t,n))return 0;var a=e[0].length,l=function(e){return e.r*a+e.c},r=[];r.push(t);var o=new Map;for(o.set(l(t),0);r.length>0;)for(var c=r.shift(),i=E(e,c),s=0;s<i.length;s++){var m=i[s];if(!o.has(l(m))){if(o.set(l(m),o.get(l(c))+1),v(m,n))return o.get(l(m));r.push(m)}}return-1}function S(e,t,n){return-1!==b(e,t,n)}function w(e,t,n,a){if(C(e,a))return!1;e[a.r][a.c]=1;var l=function(e,t,n){for(var a=0;a<t.length;a++)if(!S(e,t[a],n[a]))return!1;return!0}(e,t,n);return e[a.r][a.c]=0,l}var N=n(2),j=37,I=12,O="cyan lighten-4",x="cyan lighten-3",G="cyan lighten-5",L=["face","outlet"],M=function(e){for(var t=e.grid,n=e.ghostAction,a=Object(c.a)(e.playerColors,2),r=a[0],o=a[1],i=Object(c.a)(e.playerPos,2),s=i[0],m=i[1],u=Object(c.a)(e.goals,2),f=u[0],g=u[1],d=e.handleClick,p=e.p1ToMove,y=t.length,C=t[0].length,E=[],b=0;b<y;b++)for(var S=0;S<C;S++)E[b*C+S]={r:b,c:S};var w=[j,I],M=w[0],k=w[1],R=Object(c.a)(L,2),A=R[0],W=R[1],P=(y-1)/2,T=(C-1)/2;return l.a.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(".concat(T,", ").concat(M,"px ").concat(k,"px) ").concat(M,"px"),gridTemplateRows:"repeat(".concat(P,", ").concat(M,"px ").concat(k,"px) ").concat(M,"px"),justifyContent:"center"}},E.map((function(e){var a,c=[v(e,s),v(e,m)],i=c[0],u=c[1],y=[v(e,f),v(e,g)],C=y[0],E=y[1],b=null!==n&&v(n,e),S=b&&p,w=b&&!p,j=h(e);if(a="Ground"===j?O:"Wall"===j?G:x,C&&(a=r+" lighten-4"),E&&(a=o+" lighten-4"),"Wall"===j){var I=0!==t[e.r][e.c];(I||b)&&(I?(a=1===t[e.r][e.c]?r:o,a+=" darken-3"):(a=p?r:o,a+=" lighten-3"))}"Ground"===j&&(a+=" waves-effect waves-light"),"Wall"===j&&(a+=" waves-effect waves-dark");var L=e.r%2===1&&e.c%2===1,M=i||u||S||w;return l.a.createElement("div",{className:a,key:"cell_".concat(e.r,"_").concat(e.c),onClick:function(){L||d(e)},style:{display:"flex",justifyContent:"center",alignItems:"center"}},i&&l.a.createElement(N.Icon,{className:"".concat(r,"-text small")},A),u&&l.a.createElement(N.Icon,{className:"".concat(o,"-text small")},W),C&&!M&&l.a.createElement(N.Icon,{className:"white-text small"},A),E&&!M&&l.a.createElement(N.Icon,{className:"white-text small"},W),S&&"Ground"===j&&l.a.createElement(N.Icon,{className:"".concat(r,"-text small text-lighten-4")},A),w&&"Ground"===j&&l.a.createElement(N.Icon,{className:"".concat(o,"-text small text-lighten-4")},W))})))};n(148);var k=function(e){var t=e.gameName,n=e.showLobby,a=e.endGame,r=e.showHelp,o="WallWars";return""!==t&&(o+=" Game ".concat(t)),l.a.createElement(N.Navbar,{alignLinks:"right",brand:l.a.createElement("span",{className:"brand-logo"},o),centerLogo:!0,id:"mobile-nav",menuIcon:l.a.createElement(N.Icon,null,"menu"),options:{draggable:!0,edge:"left",inDuration:250,onCloseEnd:null,onCloseStart:null,onOpenEnd:null,onOpenStart:null,outDuration:200,preventScrolling:!0}},n&&l.a.createElement(N.NavItem,{onClick:a},"Lobby"),l.a.createElement(N.NavItem,{onClick:r},"Help"),l.a.createElement(N.NavItem,{onClick:function(){console.log("todo: show about in modal window")}},"About"))},R=function(e){var t,n=e.playerNames,a=e.lifeCycleStage,r=e.winner,o=e.finishReason,i=e.numMoves,s=e.p1ToMove,m=Object(c.a)(n,2),u=m[0],f=m[1];switch(a){case-2:t="Haven't sent a message to the server yet";break;case-1:t="Waiting for server response";break;case 0:t="Waiting for player 2 to join";break;case 1:t="".concat(s?u:f," starts");break;case 2:case 3:t="".concat(s?u:f," to move");break;case 4:t="draw"===r?"The game ended in a draw":"".concat("1"===r?u:f," won on ").concat("time"===o?"on time":"by reaching the goal");break;default:console.error("stage should be in range 0..4")}return l.a.createElement(N.Row,{className:"container valign-wrapper",style:{marginTop:"10px",marginBottom:"10px"}},l.a.createElement(N.Col,{s:8},l.a.createElement("h6",null,t)),l.a.createElement(N.Col,{s:3}),l.a.createElement(N.Col,{s:1},l.a.createElement("h6",null,i)))},A=function(e){var t=e.lifeCycleStage,n=e.playerNames,a=e.playerColors,r=e.timeLeft1,o=e.timeLeft2,i=e.p1ToMove?1:2,s=n[0],m=null===n[1]?"......":n[1],u=Object(c.a)(a,2),f=u[0],g=u[1],d=[Math.floor(r/60),Math.floor(o/60)],p=d[0],h=d[1],v=r%60,y=o%60,C=t<4&&1===i?" ".concat(f," ").concat("lighten-1 z-depth-2"):"",E=t<4&&2===i?" ".concat(g," ").concat("lighten-1 z-depth-2"):"";return l.a.createElement(N.Row,{className:"valign-wrapper container"},l.a.createElement(N.Col,{className:"center"+C,s:2},l.a.createElement("h5",null,s)),l.a.createElement(N.Col,{className:"center"+(1===i&&r<15?" ".concat("orange lighten-2 z-depth-3"):""),s:2,style:{margin:"0rem 1rem"}},l.a.createElement("h5",null,p,":",v<10&&"0",v)),l.a.createElement(N.Col,{s:4}),l.a.createElement(N.Col,{className:"center"+(2===i&&o<15?" ".concat("orange lighten-2 z-depth-3"):""),s:2,style:{margin:"0rem 1rem"}},l.a.createElement("h5",null,h,":",y<10&&"0",y)),l.a.createElement(N.Col,{className:"center"+E,s:2},l.a.createElement("h5",null,m)))},W=function(e){for(var t=[],n=0;n<e.h;n++){t[n]=[];for(var a=0;a<e.w;a++)t[n][a]=0}return t},P=function(e){var t=e.socket,n=e.creatorParams,r=e.joinerParams,o=e.lobbyReturnFromGame,i={w:23,h:19},s={tl:{r:0,c:0},tr:{r:0,c:i.w-1},bl:{r:i.h-1,c:0},br:{r:i.h-1,c:i.w-1}},m=[s.tl,s.tr],u=[s.br,s.bl],f=null!==n,g=Object(p.a)({timeControl:f?n.timeControl:null,gameId:f?null:r.gameId,p1Name:f?n.p1Name:null,p2Name:f?null:r.p2Name,p1Starts:null,lifeCycleStage:-2,numMoves:0,playerPos:m,grid:W(i),timeLeft1:f?60*n.timeControl.duration:null,timeLeft2:f?60*n.timeControl.duration:null,winner:"",finishReason:"",ghostAction:null}),y=Object(c.a)(g,2),C=y[0],E=y[1],S=function(){return C.numMoves%2===(C.p1Starts?0:1)};Object(a.useEffect)((function(){f&&-2===C.lifeCycleStage&&(E((function(e){e.lifeCycleStage=-1})),t.emit("createGame",C.timeControl,C.p1Name)),f||-2!==C.lifeCycleStage||(E((function(e){e.lifeCycleStage=-1})),t.emit("joinGame",C.gameId,C.p2Name))})),Object(a.useEffect)((function(){return t.once("gameCreated",(function(e){var t=e.gameId,n=e.p1Starts;E((function(e){0!==e.lifeCycleStage&&(e.gameId=t,e.p1Starts=n,e.lifeCycleStage=0)}))})),t.once("gameJoined",(function(e){var t=e.p1Starts,n=e.p1Name,a=e.timeControl;E((function(e){console.log("game joined ".concat(e.lifeCycleStage)),1!==e.lifeCycleStage&&(e.p1Starts=t,e.p1Name=n,e.timeControl=a,e.timeLeft1=60*a.duration,e.timeLeft2=60*a.duration,e.lifeCycleStage=1)}))})),t.once("p2Joined",(function(e){E((function(t){1!==t.lifeCycleStage&&(t.p2Name=e,t.lifeCycleStage=1)}))})),t.on("move",(function(e,t,n){E((function(a){if(console.log("move received ".concat(t," ").concat(n," ").concat(a.numMoves===t)),!(a.lifeCycleStage<1||a.lifeCycleStage>3)&&a.numMoves===t){for(var l=a.numMoves%2===(a.p1Starts?0:1)?1:2,r=0;r<e.length;r++){var o=e[r],c=h(o);if("Ground"===c){if(a.playerPos[l-1]=o,v(o,u[l-1])){var i=1===l?2:1,s=l===(a.p1Starts?1:2),m=b(a.grid,a.playerPos[i-1],u[i-1]);s&&m<=2?(a.winner="draw",a.finishReason="goal",a.lifeCycleStage=4):(a.winner=l.toString(),a.finishReason="goal",a.lifeCycleStage=4)}}else"Wall"===c?a.grid[o.r][o.c]=l:console.error("unexpected action type",c)}f?a.timeLeft2=n:a.timeLeft1=n,a.ghostAction=null,a.numMoves=t+1,1===a.lifeCycleStage&&0===t?a.lifeCycleStage=2:2===a.lifeCycleStage&&1===t&&(a.lifeCycleStage=3)}}))})),function(){t.removeAllListeners()}}),[t,E,f,C.gameId,u]),Object(a.useEffect)((function(){var e=setInterval((function(){E((function(e){3===e.lifeCycleStage&&(e.numMoves%2===(e.p1Starts?0:1)?(e.timeLeft1-=1,0===e.timeLeft1&&(e.winner="2",e.finishReason="time",e.lifeCycleStage=4)):(e.timeLeft2-=1,0===e.timeLeft2&&(e.winner="1",e.finishReason="time",e.lifeCycleStage=4)))}))}),1e3);return function(){return clearInterval(e)}}),[E]);var N=function(){return null===C.ghostAction?"None":h(C.ghostAction)},j=["red","indigo"];return l.a.createElement("div",null,l.a.createElement(k,{gameName:C.gameId,showLobby:!0,endGame:function(){return t.emit("endGame",C.gameId),void o()},showHelp:function(){return console.log("todo: show game help in modal window")}}),l.a.createElement(R,{playerNames:[C.p1Name,C.p2Name],lifeCycleStage:C.lifeCycleStage,winner:C.winner,finishReason:C.finishReason,numMoves:C.numMoves,p1ToMove:S()}),l.a.createElement(A,{lifeCycleStage:C.lifeCycleStage,playerNames:[C.p1Name,C.p2Name],playerColors:j,timeLeft1:C.timeLeft1,timeLeft2:C.timeLeft2,p1ToMove:S()}),l.a.createElement(M,{goals:u,playerPos:C.playerPos,grid:C.grid,ghostAction:C.ghostAction,playerColors:j,handleClick:function(e){if(f===S()&&!(C.lifeCycleStage<=0)&&!(C.lifeCycleStage>3)){var n=h(e);if(!(C.lifeCycleStage<3&&"Wall"===n)){var a=function(e){var t=d()(C.playerPos),n=Object(c.a)(t,2),a=n[0],l=n[1],r=S()?1:2,o=h(e);if("Ground"===o){var i=1===r?a:l;return b(C.grid,i,e)}if("Wall"===o){var s=d()(C.grid);if("Wall"===N())s[C.ghostAction.r][C.ghostAction.c]=1;else if("Ground"===N()){var m=1===r?[C.ghostAction,l]:[a,C.ghostAction],f=Object(c.a)(m,2);a=f[0],l=f[1]}return w(s,[a,l],u,e)?1:0}console.error("unexpected action type",o)}(e),l=null,r=null;if("None"===N())if("Wall"===n){if(1!==a)return;r=e}else if("Ground"===n)if(1===a)r=e;else{if(2!==a)return;l=[e]}else console.error("unexpected action type",n);else if("Wall"===N())if("Wall"===n)if(v(C.ghostAction,e))r=null;else{if(1!==a)return;l=[e,C.ghostAction]}else if("Ground"===n){if(1!==a)return;l=[e,C.ghostAction]}else console.error("unexpected action type",n);else if("Ground"===N())if("Wall"===n){if(1!==a)return;l=[e,C.ghostAction]}else if("Ground"===n)if(0===a)r=null;else if(1===a)r=e;else{if(2!==a)return;l=[e]}else console.error("unexpected action type",n);else console.error("unexpected ghost type",N());if(l){var o=f?C.timeLeft1:C.timeLeft2;3===C.lifeCycleStage&&(o+=C.timeControl.increment),t.emit("move",l,o),E((function(e){if(e.numMoves===C.numMoves){for(var t=e.numMoves%2===(e.p1Starts?0:1)?1:2,n=0;n<l.length;n++){var a=l[n],r=h(a);if("Ground"===r){if(e.playerPos[t-1]=a,v(a,u[t-1])){var c=1===t?2:1,i=t===(e.p1Starts?1:2),s=b(e.grid,e.playerPos[c-1],u[c-1]);i&&s<=2?(e.winner="draw",e.finishReason="goal",e.lifeCycleStage=4):(e.winner=t.toString(),e.finishReason="goal",e.lifeCycleStage=4)}}else"Wall"===r?e.grid[a.r][a.c]=t:console.error("unexpected action type",r)}f?e.timeLeft1=o:e.timeLeft2=o,e.ghostAction=null,e.numMoves=C.numMoves+1,1===e.lifeCycleStage&&0===C.numMoves?e.lifeCycleStage=2:2===e.lifeCycleStage&&1===C.numMoves&&(e.lifeCycleStage=3)}}))}else E((function(e){e.ghostAction=r}))}}},p1ToMove:S()}))},T=function(e){var t=e.playerName,n=e.handlePlayerName,a=e.duration,r=e.handleDuration,o=e.increment,c=e.handleIncrement,i=e.joinGameId,s=e.handleJoinGameId,m=e.handleCreateGame,u=e.handleJoinGame;return l.a.createElement("div",{className:"container teal darken-2",style:{marginTop:"2rem"}},l.a.createElement(N.Row,{className:"valign-wrapper"},l.a.createElement(N.Col,{className:"center",s:3},l.a.createElement("h5",null,"Your name:")),l.a.createElement(N.Col,{s:3},l.a.createElement(N.TextInput,{id:"nameInput",value:t,onChange:n})),l.a.createElement(N.Col,{s:6})),l.a.createElement(N.Row,{className:"valign-wrapper"},l.a.createElement(N.Col,{className:"center",s:3},l.a.createElement(N.Button,{node:"button",waves:"light",onClick:m},"Create game")),l.a.createElement(N.Col,{s:1,style:{paddingRight:"0"}},l.a.createElement(N.TextInput,{id:"durationInput",label:"Duration",value:"".concat(a),onChange:r})),l.a.createElement(N.Col,{s:1,style:{paddingLeft:"0"}},"m"),l.a.createElement(N.Col,{s:1,style:{paddingRight:"0"}},l.a.createElement(N.TextInput,{id:"incrementInput",label:"Increment",value:"".concat(o),onChange:c})),l.a.createElement(N.Col,{s:1,style:{paddingLeft:"0"}},"s"),l.a.createElement(N.Col,{s:5})),l.a.createElement(N.Row,{className:"valign-wrapper"},l.a.createElement(N.Col,{className:"center",s:3},l.a.createElement(N.Button,{node:"button",waves:"light",onClick:u},"Join game")),l.a.createElement(N.Col,{s:5},l.a.createElement(N.TextInput,{id:"joinInput",placeholder:"Write game code here...",value:"".concat(i),onChange:s})),l.a.createElement(N.Col,{s:4})))},J=function(e){var t=e.socket,n=Object(a.useState)(Object(f.b)({dictionaries:[f.a],length:1}).slice(0,6)),r=Object(c.a)(n,2),o=r[0],i=r[1],s=Object(a.useState)(5),m=Object(c.a)(s,2),u=m[0],g=m[1],d=Object(a.useState)(2),p=Object(c.a)(d,2),h=p[0],v=p[1],y=Object(a.useState)(""),C=Object(c.a)(y,2),E=C[0],b=C[1],S=Object(a.useState)(!1),w=Object(c.a)(S,2),N=w[0],j=w[1],I=Object(a.useState)(null),O=Object(c.a)(I,2),x=O[0],G=O[1],L=Object(a.useState)(null),M=Object(c.a)(L,2),R=M[0],A=M[1];return l.a.createElement("div",null,N&&l.a.createElement(P,{socket:t,creatorParams:x,joinerParams:R,lobbyReturnFromGame:function(){j(!1),G(null),A(null),b("")}}),!N&&l.a.createElement("div",null,l.a.createElement(k,{gameName:"",showHelp:function(){return console.log("todo: show lobby help in modal window")}}),l.a.createElement(T,{playerName:o,handlePlayerName:function(e){return i(e.target.value)},duration:u,handleDuration:function(e){return g(e.target.value)},increment:h,handleIncrement:function(e){return v(e.target.value)},joinGameId:E,handleJoinGameId:function(e){return b(e.target.value)},handleCreateGame:function(){G({timeControl:{duration:u,increment:h},p1Name:o}),j(!0)},handleJoinGame:function(){A({gameId:E,p2Name:o}),j(!0)}})))},D=function(){var e=Object(a.useState)(u()("https://wallwars.herokuapp.com/")),t=Object(c.a)(e,1)[0];return l.a.createElement(l.a.StrictMode,null,l.a.createElement(i.a,null,l.a.createElement(s.d,null,l.a.createElement(s.b,{path:"/",exact:!0},l.a.createElement(J,{socket:t})),l.a.createElement(s.a,{to:"/"}))))};o.a.render(l.a.createElement(D,null),document.getElementById("root"))},65:function(e,t,n){e.exports=n(151)},70:function(e,t,n){}},[[65,1,2]]]);
//# sourceMappingURL=main.a1554174.chunk.js.map