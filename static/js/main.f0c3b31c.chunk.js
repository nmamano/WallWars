(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{100:function(e,t){},151:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),l=n(34),o=n.n(l),c=(n(70),n(6)),i=n(62),s=n(4),u=n(61),m=n.n(u),h=n(38),g=n(35),d=n.n(g),f=n(64);function p(e){return e.r%2===0&&e.c%2===0?"Ground":e.r%2===0&&e.c%2===1||e.r%2===1&&e.c%2===0?"Wall":"Pillar"}function y(e,t){return e.r===t.r&&e.c===t.c}function v(e,t){return e.r>=0&&e.r<t.h&&e.c>=0&&e.c<t.w}function b(e,t){return"Wall"===p(t)&&0!==e[t.r][t.c]}function E(e,t){var n=function(e){return{h:e.length,w:e[0].length}}(e);if("Ground"!==p(t))return[];for(var a=[{r:0,c:1},{r:0,c:-1},{r:1,c:0},{r:-1,c:0}],r=[],l=[t.r,t.c],o=l[0],c=l[1],i=0;i<a.length;i++){var s=[a[i].r,a[i].c],u=s[0],m=s[1],h={r:o+u,c:c+m},g={r:o+2*u,c:c+2*m};v(g,n)&&!b(e,h)&&r.push(g)}return r}function C(e,t,n){if(y(t,n))return 0;var a=e[0].length,r=function(e){return e.r*a+e.c},l=[];l.push(t);var o=new Map;for(o.set(r(t),0);l.length>0;)for(var c=l.shift(),i=E(e,c),s=0;s<i.length;s++){var u=i[s];if(!o.has(r(u))){if(o.set(r(u),o.get(r(c))+1),y(u,n))return o.get(r(u));l.push(u)}}return-1}function w(e,t,n){return-1!==C(e,t,n)}function S(e,t,n,a){if(b(e,a))return!1;e[a.r][a.c]=1;var r=function(e,t,n){for(var a=0;a<t.length;a++)if(!w(e,t[a],n[a]))return!1;return!0}(e,t,n);return e[a.r][a.c]=0,r}var j=n(2),x=37,N=12,k="cyan lighten-4",I="cyan lighten-3",T="cyan lighten-5",O=["face","outlet"],G=function(e){for(var t=e.grid,n=e.ghostAction,a=Object(c.a)(e.playerColors,2),l=a[0],o=a[1],i=Object(c.a)(e.playerPos,2),s=i[0],u=i[1],m=Object(c.a)(e.goals,2),h=m[0],g=m[1],d=e.handleClick,f=e.creatorToMove,v=t.length,b=t[0].length,E=[],C=0;C<v;C++)for(var w=0;w<b;w++)E[C*b+w]={r:C,c:w};var S=[x,N],G=S[0],W=S[1],A=Object(c.a)(O,2),L=A[0],P=A[1],R=(v-1)/2,_=(b-1)/2;return r.a.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(".concat(_,", ").concat(G,"px ").concat(W,"px) ").concat(G,"px"),gridTemplateRows:"repeat(".concat(R,", ").concat(G,"px ").concat(W,"px) ").concat(G,"px"),justifyContent:"center"}},E.map((function(e){var a,c=[y(e,s),y(e,u)],i=c[0],m=c[1],v=[y(e,h),y(e,g)],b=v[0],E=v[1],C=null!==n&&y(n,e),w=C&&f,S=C&&!f,x=p(e);if(a="Ground"===x?k:"Wall"===x?T:I,b&&(a=l+" lighten-4"),E&&(a=o+" lighten-4"),"Wall"===x){var N=0!==t[e.r][e.c];(N||C)&&(N?(a=1===t[e.r][e.c]?l:o,a+=" darken-3"):(a=f?l:o,a+=" lighten-3"))}"Ground"===x&&(a+=" waves-effect waves-light"),"Wall"===x&&(a+=" waves-effect waves-dark");var O=e.r%2===1&&e.c%2===1,G=i||m||w||S;return r.a.createElement("div",{className:a,key:"cell_".concat(e.r,"_").concat(e.c),onClick:function(){O||d(e)},style:{display:"flex",justifyContent:"center",alignItems:"center"}},i&&r.a.createElement(j.Icon,{className:"".concat(l,"-text small")},L),m&&r.a.createElement(j.Icon,{className:"".concat(o,"-text small")},P),b&&!G&&r.a.createElement(j.Icon,{className:"white-text small"},L),E&&!G&&r.a.createElement(j.Icon,{className:"white-text small"},P),w&&"Ground"===x&&r.a.createElement(j.Icon,{className:"".concat(l,"-text small text-lighten-4")},L),S&&"Ground"===x&&r.a.createElement(j.Icon,{className:"".concat(o,"-text small text-lighten-4")},P))})))};n(148);var W=function(e){var t=e.gameName,n=e.showLobby,a=e.endGame,l=e.helpText,o="WallWars";t&&""!==t&&(o+=" Game ".concat(t));var c=r.a.createElement("div",null,r.a.createElement("h6",null,"Wallwars is an online 2-player strategy game. The goal is to get to your goal before the opponent gets to hers, building walls to reshape the terrain to your advantage."),r.a.createElement("h6",null,"It is implemented by Nil M and inspired by a board game he played once as a kid, of which he doesn't remember the name, unfortunately."),r.a.createElement("h6",null,"The frontend is made with React, and the backend with Node.js, Express, and socket.io."),r.a.createElement("h6",null,"The source code is available at https://github.com/nmamano/WallWars"));return r.a.createElement(j.Navbar,{alignLinks:"right",brand:r.a.createElement("span",null,o),menuIcon:r.a.createElement(j.Icon,null,"menu"),options:{draggable:!0,edge:"left",inDuration:250,onCloseEnd:null,onCloseStart:null,onOpenEnd:null,onOpenStart:null,outDuration:200,preventScrolling:!0}},n&&r.a.createElement(j.NavItem,{onClick:a},"Lobby"),r.a.createElement(j.Modal,{style:{color:"black"},actions:[r.a.createElement(j.Button,{style:{backgroundColor:"#009688",color:"white"},flat:!0,modal:"close",node:"button",waves:"green"},"Close")],bottomSheet:!1,fixedFooter:!1,header:"Help",id:"modal1",open:!1,options:{dismissible:!0,endingTop:"10%",inDuration:250,opacity:.4,outDuration:250,preventScrolling:!0,startingTop:"4%"},trigger:r.a.createElement(j.NavItem,null,"Help")},l),r.a.createElement(j.Modal,{style:{color:"black"},actions:[r.a.createElement(j.Button,{style:{backgroundColor:"#009688",color:"white"},flat:!0,modal:"close",node:"button",waves:"green"},"Close")],bottomSheet:!1,fixedFooter:!1,header:"About",id:"modal1",open:!1,options:{dismissible:!0,endingTop:"10%",inDuration:250,opacity:.4,outDuration:250,preventScrolling:!0,startingTop:"4%"},trigger:r.a.createElement(j.NavItem,null,"About")},c))},A=function(e){var t,n=e.names,a=e.lifeCycleStage,l=e.winner,o=e.finishReason,c=e.turnCount,i=e.indexToMove,s=e.timeControl,u=n[i];switch(a){case-2:t="Haven't tried to connect to the server yet";break;case-1:t="Waiting for server response";break;case 0:t="Waiting for player 2 to join";break;case 1:t="".concat(u," starts");break;case 2:case 3:t="".concat(u," to move");break;case 4:t="draw"===l?"The game ended in a draw":"".concat(n["creator"===l?0:1]," won ").concat("time"===o?"on time":"by reaching the goal");break;default:console.error("stage should be in range [-2..4]")}return r.a.createElement(j.Row,{className:"container valign-wrapper",style:{marginTop:"10px",marginBottom:"10px"}},r.a.createElement(j.Col,{s:5},r.a.createElement("h6",null,t)),r.a.createElement(j.Col,{s:6},s&&r.a.createElement("h6",null,"Time control: ",s.duration,"+",s.increment)),r.a.createElement(j.Col,{s:1},r.a.createElement("h6",null,c)))},L=function(e){var t=e.lifeCycleStage,n=e.names,a=e.playerColors,l=e.timeLeft,o=e.indexToMove,c=[Math.floor(l[0]/60),Math.floor(l[1]/60)],i=c[0],s=c[1],u=l[0]%60,m=l[1]%60,h=["".concat(i,":").concat(u<10?"0":"").concat(u),"".concat(s,":").concat(m<10?"0":"").concat(m)];t<0&&(h[0]="_:__",h[1]="_:__");var g=["",""];if(t<4){g[o]=" ".concat(a[o]," ").concat("lighten-1 z-depth-2")}var d=["",""];return 3===t&&(0===o?l[0]<15&&(d[0]=" ".concat("orange lighten-2 z-depth-3")):1===o&&l[1]<15&&(d[1]=" ".concat("orange lighten-2 z-depth-3"))),r.a.createElement(j.Row,{className:"valign-wrapper container"},r.a.createElement(j.Col,{className:"center"+g[0],s:2},r.a.createElement("h5",null,n[0])),r.a.createElement(j.Col,{className:"center"+d[0],s:2,style:{margin:"0rem 1rem"}},r.a.createElement("h5",null,h[0])),r.a.createElement(j.Col,{s:4}),r.a.createElement(j.Col,{className:"center"+d[1],s:2,style:{margin:"0rem 1rem"}},r.a.createElement("h5",null,h[1])),r.a.createElement(j.Col,{className:"center"+g[1],s:2},r.a.createElement("h5",null,null===n[1]?"______":n[1])))},P=function(){return r.a.createElement("div",null,r.a.createElement("h6",null,'To connect with your friend, share the game code in the top header with them and tell them to use it when clicking "Join Game" from the lobby.'),r.a.createElement("h6",null,"Rules of the game:"),r.a.createElement("h6",null,"The player who created the game starts at the top left corner (color red). The player who joined the game starts at the top right (color blue). The goal of each player is to reach the ",r.a.createElement("em",null,"opposite")," corner from where they start. The player who gets there first, wins."),r.a.createElement("h6",null,"Players move by clicking cells on the board. There are two types of cells: ground cells (the big squares) and walls (the thin rectangles in between ground cells). Each move consists of a total of two actions. One action can be building one wall or moving to an adjacent cell (a diagonal move counts as two actions)."),r.a.createElement("h6",null,"Players can build walls to obstruct the opponent. Walls can be built anywhere as long as there always exists at least one way to get to their goal."),r.a.createElement("h6",null,"The remaining time for each player is shown next to their name. The clock of a player ticks down when it is their turn (after each player has moved once). The player who starts is chosen randomly. The name of the player to move next is highlighted with their color."),r.a.createElement("h6",null,"If it is your turn and you do a single action, like building a wall or moving to an adjacent cell, you can undo it by clicking the wall again or clicking a different ground cell, respectively. Once you choose 2 actions, the move becomes permanent."),r.a.createElement("h6",null,"Special rules:"),r.a.createElement("h6",null,"(1) no walls can be placed during the first move of each player."),r.a.createElement("h6",null,"(2) if the player who moved first reaches the goal first but the other player is at distance 1 or 2 from her goal, the game ends in a draw."),r.a.createElement("h6",null,"Note: if you return to the lobby, you will not be able to reenter this game!"))},R={w:23,h:19},_={tl:{r:0,c:0},tr:{r:0,c:R.w-1},bl:{r:R.h-1,c:0},br:{r:R.h-1,c:R.w-1}},M=[_.tl,_.tr],J=[_.br,_.bl],D=["red","indigo"],B=function(e,t){return e%2===(t?0:1)},F=function(e,t){return B(e,t)?0:1},H=function(e){return e%2===0},z=function(e){for(var t=[],n=0;n<e.h;n++){t[n]=[];for(var a=0;a<e.w;a++)t[n][a]=0}return t},q=function(e){return null===e?"None":p(e)},Y=function(e,t,n,a){if(!(e.lifeCycleStage<1||e.lifeCycleStage>3)&&e.turnCount===n-1){for(var r=F(e.turnCount,e.creatorStarts),l=0===r?1:0,o=0;o<t.length;o++){var c=t[o],i=p(c);if("Ground"===i){if(e.playerPos[r]=c,y(c,J[r])){var s=H(e.turnCount),u=C(e.grid,e.playerPos[l],J[l]);s&&u<=2?(e.winner="draw",e.finishReason="goal",e.lifeCycleStage=4):(e.winner=0===r?"creator":"joiner",e.finishReason="goal",e.lifeCycleStage=4)}}else"Wall"===i?e.grid[c.r][c.c]=r+1:console.error("unexpected action type",i)}a&&(e.timeLeft[r]=a),e.ghostAction=null,e.turnCount=n,1===e.lifeCycleStage&&1===n?e.lifeCycleStage=2:2===e.lifeCycleStage&&2===n&&(e.lifeCycleStage=3)}},K=function(e){var t=e.socket,n=e.creatorParams,l=e.joinerParams,o=e.returnToLobby,i=null!==n,s=Object(f.a)({gameId:i?null:l.gameId,timeControl:i?n.timeControl:null,names:[i?n.creatorName:null,i?null:l.joinerName],creatorStarts:null,turnCount:0,playerPos:M,grid:z(R),timeLeft:[i?60*n.timeControl.duration:null,i?60*n.timeControl.duration:null],winner:"",finishReason:"",lifeCycleStage:-2,ghostAction:null}),u=Object(c.a)(s,2),m=u[0],h=u[1];Object(a.useEffect)((function(){-2===m.lifeCycleStage&&(i&&(h((function(e){e.lifeCycleStage=-1})),t.emit("createGame",m.timeControl,m.names[0])),i||(h((function(e){e.lifeCycleStage=-1})),t.emit("joinGame",m.gameId,m.names[1])))})),Object(a.useEffect)((function(){return t.once("gameCreated",(function(e){var t=e.gameId,n=e.creatorStarts;h((function(e){0!==e.lifeCycleStage&&(e.gameId=t,e.creatorStarts=n,e.lifeCycleStage=0)}))})),t.once("gameJoined",(function(e){var t=e.creatorStarts,n=e.creatorName,a=e.timeControl;h((function(e){console.log("game joined"),1!==e.lifeCycleStage&&(e.creatorStarts=t,e.names[0]=n,e.timeControl=a,e.timeLeft=[60*a.duration,60*a.duration],e.lifeCycleStage=1)}))})),t.once("joinerJoined",(function(e){h((function(t){1!==t.lifeCycleStage&&(t.names[1]=e,t.lifeCycleStage=1)}))})),t.on("move",(function(e,t,n){h((function(a){console.log("move ".concat(t," received ").concat(n)),Y(a,e,t,n)}))})),function(){t.removeAllListeners()}}),[t,h,i,m.gameId]),Object(a.useEffect)((function(){var e=setInterval((function(){h((function(e){if(3===e.lifeCycleStage){var t=F(e.turnCount,e.creatorStarts);e.timeLeft[t]-=1,0===e.timeLeft[t]&&(e.winner=0===t?"joiner":"creator",e.finishReason="time",e.lifeCycleStage=4)}}))}),1e3);return function(){return clearInterval(e)}}),[h]);return r.a.createElement("div",null,r.a.createElement(W,{gameName:m.gameId,showLobby:!0,endGame:function(){t.emit("endGame",m.gameId),o()},helpText:P()}),r.a.createElement(A,{lifeCycleStage:m.lifeCycleStage,names:m.names,indexToMove:F(m.turnCount,m.creatorStarts),winner:m.winner,finishReason:m.finishReason,turnCount:m.turnCount,timeControl:m.timeControl}),r.a.createElement(L,{lifeCycleStage:m.lifeCycleStage,names:m.names,indexToMove:F(m.turnCount,m.creatorStarts),playerColors:D,timeLeft:m.timeLeft}),r.a.createElement(G,{creatorToMove:B(m.turnCount,m.creatorStarts),playerColors:D,grid:m.grid,playerPos:m.playerPos,goals:J,ghostAction:m.ghostAction,handleClick:function(e){if(i===B(m.turnCount,m.creatorStarts)&&!(m.lifeCycleStage<1)&&!(m.lifeCycleStage>3)){var n=p(e);if(!(m.lifeCycleStage<3&&"Wall"===n)){var a=function(e){var t=F(m.turnCount,m.creatorStarts),n=p(e);if("Ground"===n)return C(m.grid,m.playerPos[t],e);if("Wall"===n){var a=d()(m.grid),r=d()(m.playerPos),l=q(m.ghostAction);return"Wall"===l?a[m.ghostAction.r][m.ghostAction.c]=1:"Ground"===l&&(r[t]=m.ghostAction),S(a,r,J,e)?1:0}console.error("unexpected action type",n)}(e),r=q(m.ghostAction),l=null,o=null;if("None"===r)if("Wall"===n){if(1!==a)return;o=e}else if("Ground"===n)if(1===a)o=e;else{if(2!==a)return;l=[e]}else console.error("unexpected action type",n);else if("Wall"===r)if("Wall"===n)if(y(m.ghostAction,e))o=null;else{if(1!==a)return;l=[e,m.ghostAction]}else if("Ground"===n){if(1!==a)return;l=[e,m.ghostAction]}else console.error("unexpected action type",n);else if("Ground"===r)if("Wall"===n){if(1!==a)return;l=[e,m.ghostAction]}else if("Ground"===n)if(0===a)o=null;else if(1===a){if(y(e,m.ghostAction))return;o=e}else{if(2!==a)return;l=[e]}else console.error("unexpected action type",n);else console.error("unexpected ghost type",r);if(l){var c=F(m.turnCount,m.creatorStarts),s=m.timeLeft[c];3===m.lifeCycleStage&&(s+=m.timeControl.increment),t.emit("move",l,s),h((function(e){Y(e,l,m.turnCount+1,s)}))}else h((function(e){e.ghostAction=o}))}}}}))},Q=function(e){var t=e.playerName,n=e.handlePlayerName,a=e.duration,l=e.handleDuration,o=e.increment,c=e.handleIncrement,i=e.joinGameId,s=e.handleJoinGameId,u=e.handleCreateGame,m=e.handleJoinGame;return r.a.createElement("div",{className:"container teal darken-2",style:{marginTop:"2rem"}},r.a.createElement(j.Row,{className:"valign-wrapper"},r.a.createElement(j.Col,{className:"center",s:3},r.a.createElement("h5",null,"Your name:")),r.a.createElement(j.Col,{s:3},r.a.createElement(j.TextInput,{id:"nameInput",value:t,onChange:n})),r.a.createElement(j.Col,{s:6})),r.a.createElement(j.Row,{className:"valign-wrapper"},r.a.createElement(j.Col,{className:"center",s:3},r.a.createElement(j.Button,{node:"button",waves:"light",onClick:u},"Create game")),r.a.createElement(j.Col,{s:1,style:{paddingRight:"0"}},r.a.createElement(j.TextInput,{id:"durationInput",label:"Duration",value:"".concat(a),onChange:l})),r.a.createElement(j.Col,{s:1,style:{paddingLeft:"0"}},"m"),r.a.createElement(j.Col,{s:1,style:{paddingRight:"0"}},r.a.createElement(j.TextInput,{id:"incrementInput",label:"Increment",value:"".concat(o),onChange:c})),r.a.createElement(j.Col,{s:1,style:{paddingLeft:"0"}},"s"),r.a.createElement(j.Col,{s:5})),r.a.createElement(j.Row,{className:"valign-wrapper"},r.a.createElement(j.Col,{className:"center",s:3},r.a.createElement(j.Button,{node:"button",waves:"light",onClick:m},"Join game")),r.a.createElement(j.Col,{s:5},r.a.createElement(j.TextInput,{id:"joinInput",placeholder:"Write game code here...",value:"".concat(i),onChange:s})),r.a.createElement(j.Col,{s:4})))},U=function(){return r.a.createElement("div",null,r.a.createElement("h6",null,"This is the lobby. Here, you can create games that your friends can join, or join a friend's game."),r.a.createElement("h6",null,"When you create a game, you can choose the ",r.a.createElement("em",null,"duration")," (the time that each player has) and a time",r.a.createElement("em",null,"increment")," that is added to each player after they move."),r.a.createElement("h6",null,"Once you create a game, a ",r.a.createElement("em",null,"game code")," will appear in the top header. Share this code with your friend to play with them."),r.a.createElement("h6",null,'To join a friend\'s game, write the code they give you in the box next to the "Join game" button and click it.'),r.a.createElement("h6",null,"A random ",r.a.createElement("em",null,"username")," has been chosen for you, but you can change it."))},V=function(e){var t=e.socket,n=Object(a.useState)(Object(h.b)({dictionaries:[h.a],length:1}).slice(0,6)),l=Object(c.a)(n,2),o=l[0],i=l[1],s=Object(a.useState)(3),u=Object(c.a)(s,2),m=u[0],g=u[1],d=Object(a.useState)(2),f=Object(c.a)(d,2),p=f[0],y=f[1],v=Object(a.useState)(""),b=Object(c.a)(v,2),E=b[0],C=b[1],w=Object(a.useState)(!1),S=Object(c.a)(w,2),j=S[0],x=S[1],N=Object(a.useState)(null),k=Object(c.a)(N,2),I=k[0],T=k[1],O=Object(a.useState)(null),G=Object(c.a)(O,2),A=G[0],L=G[1];return r.a.createElement("div",{style:{marginBottom:"2rem"}},j&&r.a.createElement(K,{socket:t,creatorParams:I,joinerParams:A,returnToLobby:function(){x(!1),T(null),L(null),C("")}}),!j&&r.a.createElement("div",null,r.a.createElement(W,{gameName:"",helpText:U()}),r.a.createElement(Q,{playerName:o,handlePlayerName:function(e){i(e.target.value.slice(0,8))},duration:m,handleDuration:function(e){return g(e.target.value)},increment:p,handleIncrement:function(e){return y(e.target.value)},joinGameId:E,handleJoinGameId:function(e){return C(e.target.value)},handleCreateGame:function(){var e=[parseFloat(m),parseFloat(p)],t=e[0],n=e[1];(isNaN(t)||t<.1)&&(t=3,console.log("given duration is not a number, using default value instead")),(isNaN(n)||n<0)&&(n=2,console.log("given increment is not a number, using default value instead")),T({timeControl:{duration:t,increment:n},creatorName:o}),x(!0)},handleJoinGame:function(){L({gameId:E,joinerName:o}),x(!0)}})))},X=function(){console.log("connecting to backend at ".concat("https://wallwars.herokuapp.com/"));var e=Object(a.useState)(m()("https://wallwars.herokuapp.com/")),t=Object(c.a)(e,1)[0];return r.a.createElement(r.a.StrictMode,null,r.a.createElement(i.a,null,r.a.createElement(s.d,null,r.a.createElement(s.b,{path:"/wallwars/index.html",exact:!0},r.a.createElement(V,{socket:t})),r.a.createElement(s.a,{to:"/wallwars/index.html"}))))};o.a.render(r.a.createElement(X,null),document.getElementById("root"))},65:function(e,t,n){e.exports=n(151)},70:function(e,t,n){}},[[65,1,2]]]);
//# sourceMappingURL=main.f0c3b31c.chunk.js.map